# Chapter 1 Monitoring and Logging Tools
**Monitoring and Logging Tools** คือเครื่องมือที่ใช้ในการตรวจสอบและบันทึกข้อมูลเกี่ยวกับระบบหรือแอปพลิเคชันที่ทำงานในสภาพแวดล้อม IT หรือเครือข่ายโดยเฉพาะเพื่อดูแลและจัดการปัญหาที่อาจเกิดขึ้นได้หลายๆ ครั้ง, Monitoring และ Logging ถูกใช้ร่วมกันเพื่อช่วยในการตรวจสอบปัญหาและวิเคราะห์การดำเนินการของระบบ นอกจากนี้เครื่องมือเหล่านี้ยังช่วยในการค้นหาปัญหา ปรับปรุงประสิทธิภาพและเพิ่มความมั่นคงของระบบ <br>
- **Monitoring** เครื่องมือตรวจสอบเป็นทั้งซอฟต์แวร์และฮาร์ดแวร์ที่ใช้ในการตรวจสอบ วัด รายงานสถานะและประสิทธิภาพของระบบคอมพิวเตอร์ เครือข่ายและแอปพลิเคชัน การตรวจสอบเป็นขั้นตอนสำคัญในการดูแลระบบ IT เพื่อป้องกันปัญหาที่อาจเกิดขึ้นและให้การแก้ไขที่รวดเร็วเมื่อเกิดปัญหา <br>
- **Logging** เครื่องมือที่ใช้ในการบันทึกข้อมูลหรือเหตุการณ์ที่เกิดขึ้นในระบบคอมพิวเตอร์ แอปพลิเคชันหรือระบบเครือข่าย ข้อมูลที่ถูกบันทึกนี้เรียกว่า "logs" หรือ "log entries" และมักจะประกอบด้วยข้อมูลที่สำคัญเกี่ยวกับเหตุการณ์ เวลาที่เกิดขึ้นและรายละเอียดเพิ่มเติมที่เป็นประโยชน์ในการตรวจสอบและวิเคราะห์ <br>


สำหรับองค์กรที่มีการลงทุนในเรื่องของระบบ Security มักจะคุ้นเคยกับสิ่งที่เรียกว่า Log และการจัดเก็บข้อมูลอย่างถูกต้องเหมาะสม เรามักมีคำถามว่าทำไมจึงจำเป็นต้องเก็บข้อมูล Log ด้วย อาจมีการตั้งคำถามว่าการลงทุนในส่วนนี้เป็นการสิ้นเปลืองหรือไม่ เอางบประมาณไปจัดซื้อ Security Control หรืออุปกรณ์อื่นๆ ที่จำเป็นจะดีกว่าไหม ด้วยข้อโต้แย้งต่างๆ

# Log คืออะไร
ข้อมูลหรือสิ่งที่อุปกรณ์แต่ละตัวในระบบคอมพิวเตอร์จะสื่อสารกับผู้ใช้งานหรือผู้ดูแลระบบ ซึ่งในอุปกรณ์หลายชนิดในระบบคอมพิวเตอร์ ล้วนมีความสามารถในการสื่อสารกับผู้ใช้งานผ่านช่องทางของ Log ด้วยกันทั้งสิ้น นั่นหมายความว่าอุปกรณ์ในระบบคอมพิวเตอร์มี Log สำหรับสื่อสารกับผู้ใช้งาน <br>
หากรู้ว่าคอมพิวเตอร์พยายามบอกอะไรเราก็จะทำให้เราสามารถแก้ไขปัญหา หรือป้องกันไม่ให้ปัญหาเกิดขึ้นได้ Log สำหรับบางระบบยังสามารถช่วยเหลือเราในงานด้านการ Audit หรือ Review ข้อมูลการใช้งานของผู้ใช้งาน และสามารถใช้ในงานด้านความมั่นคงปลอดภัยให้กับระบบงานได้เช่นกัน ในระบบ Security ข้อมูล Log นับเป็นสิ่งที่สำคัญมากสิ่งหนึ่งในการกำกับดูแลความมั่นคงปลอดภัยด้าน Security (Security Governance)


## ใช้ประโยชน์ข้อมูลจาก Log ได้อย่างไร
ข้อมูล Log มีกระจายอยู่ตามอุปกรณ์ต่างๆ ทั่วทั้งองค์กรโดยอยู่ตามเครื่องคอมพิวเตอร์, ซอฟท์แวร์, อุปกรณ์เน็ตเวิร์คต่างๆ การที่จะทำการ review แบบ one-by-one ย่อมเป็นไปได้ยากมีโอกาสที่จะทำให้สำเร็จ หรือเกิดประสิทธิผล (efficiency) ดังนั้นการที่จะทำให้สามารถใช้ประโยชน์จากขอมูลที่กระจัดกระจายอยู่นี้ทำได้โดยจัดการให้ข้อมูลทุกอย่างนั้นมาอยู่ที่เดียวกัน การมีระบบศูนย์กลางในการบริหารจัดการข้อมูล Centralized Log Management (SIM/SIEM) เมื่อข้อมูลทุกอย่างอยู่ที่ศูนย์กลางแล้วก็สามารถบริหารจัดการได้โดยง่าย สามารถมองเห็นภาพรวมของสถานะ และคาดการณ์ถึงแนวโน้มด้านความปลอดภัยของระบบรวมถึงการวิเคราะห์วางแผนการป้องกันปัญหาที่คาดว่าจะเกิดขึ้น

## ข้อมูลจำนวนมากจาก Log
การบริหารจัดการ Log ให้ถูกต้องครบถ้วน มักจะเจอปัญหาที่มีข้อมูลภายใน Log ขององค์กรมีจำนวนมากเกินไป ควรจึง **เก็บเท่าที่จำเป็น ไม่ต้องเก็บทุกอย่าง** โดยเราควรจะมีการตั้งเวลาการลบของแต่ละเครือข่ายหรือ network เช่น จะลบ Log เมื่อเวลาผ่านไป 1 - 2 ปี (ลบ Log ที่ถูกเก็บไว้ตามเวลานั้น) หรือจะเลือกเก็บเฉพาะ Log ที่จำเป็นภายในองค์กร ตาม พรบ. คอมพิวเตอร์ เป็นหลัก คือ ต้องเก็บรักษาไว้ไม่น้อยกว่า 90 วัน เป็นอย่างน้อย ในบางองค์กรจำเป็นต้องเก็บรักษาไว้นานกว่านี้ด้วยเหตุผลในด้าน Business สำหรับเวลาดังกล่าวจะอ้างอิงถึง Log ที่เป็น Mandatory หรืออุปกรณ์หลักๆ ที่จำเป็นต้องเก็บ อาทิเช่น Firewall, DHCP, Authentication Server, Proxy หรือ Internet Gateway, เครื่องแม่ข่ายที่เปิดให้บริการกับบุคคลทั่วไป เป็นต้น ดังนั้น ในส่วนของ Log ที่ไม่ได้เป็นอุปกรณ์หลักนั้นสามารถกำหนด Retention Period ได้ตามความเหมาะสม เพื่อให้ไม่เป็นภาระในด้านค่าใช้จ่ายต่างๆ ที่จะเกิดขึ้น

# Monitoring คืออะไร
เครื่องมือตรวจสอบเป็นทั้งซอฟต์แวร์และฮาร์ดแวร์ที่ใช้ในการตรวจสอบ วัด รายงานสถานะและประสิทธิภาพของระบบคอมพิวเตอร์ เครือข่ายและแอปพลิเคชั่น กระบวนการรวบรวม การวิเคราะห์ และใช้ข้อมูลเพื่อติดตามความคืบหน้าของระบบเพื่อการบรรลุวัตถุประสงค์ และเป็นแนวทางในการตัดสินใจ Monitoring เน้นไปที่การเฝ้าดู metrics เฉพาะ และ Logs จะให้ข้อมูลเพิ่มเติม แต่โดยทั่วไปจะดูแยกตามบริบทของระบบ

## Monitoring สำคัญอย่างไรต่อระบบ
Monitoring จะทำให้เห็นประสิทธิภาพโดยรวมของระบบ เมื่อ monitor ฐานข้อมูล คุณต้องการทราบเกี่ยวกับ latency ในการเขียนข้อมูลลงดิสก์หรือการตอบสนองของกรองข้อมูล (query) โดยเฉลี่ย ผู้ดูแลฐานข้อมูลที่มีประสบการณ์จะสามารถสังเกตเห็นรูปแบบที่อาจเป็นปัญหาที่พบบ่อย ตัวอย่างเช่น การเพิ่มขึ้นของการใช้ memory การลดลงของ cache hit ratio หรือการเพิ่ม CPU Utilization ปัญหาเหล่านี้อาจแสดงถึงกรองข้อมูล (query) ที่เขียนได้อย่างไม่ดีที่ควรถูกจัดการและแก้ไข

# Monitoring Tools เครื่องมือตรวจสอบต่างๆ
- Nagios โปรแกรมใช้ในการเฝ้าระวังระบบเครือข่ายในองค์กร (Network Monitoring) แบบ Open-Source
- Prometheus ระบบ monitoring และ alerting tookit เน้นไปที่การตรวจสอบแบบเหตุการณ์
- Zabbix เครื่องมือที่รวบรวมข้อมูลเชิงปริมาณและคุณภาพของระบบและเครือข่าย
- Datadog แพลตฟอร์มการตรวจสอบและความปลอดภัยที่จำเป็นสำหรับแอปพลิเคชันระบบคลาวด์
- Grafana ตัวอินเทอร์เฟซสำหรับแสดงผลข้อมูลจากตรวจสอบต่างๆ, สามารถใช้ร่วมกับ Prometheus, InfluxDB, และอื่นๆ

# Logging Tools
- ELK Stack (Elasticsearch, Logstash, Kibana) ชุดเครื่องมือที่ใช้ในการเก็บข้อมูลบันทึก (logs), ประมวลผลข้อมูล, และแสดงผลข้อมูล
- Splunk บริการบันทึกและการวิเคราะห์ที่ใหญ่ขึ้นที่นิยมในองค์กรใหญ่.
- Fluentd ระบบที่ให้บริการด้านการเก็บข้อมูลบันทึกแบบเปิด (open-source) และรองรับการทำงานร่วมกับหลายแหล่งข้อมูล
- Graylog เครื่องมือการบันทึกและตรวจสอบที่ให้บริการแบบเปิด (open-source) ซึ่งรวม Log Management และ Security Information and Event Management (SIEM)

## Nagios
เป็นโปรแกรมใช้ในการเฝ้าระวังระบบเครือข่ายในองค์กร (Network Monitoring) สามารถนำไปติดตั้งใช้งานได้ฟรี ณ ปัจจุบันสามารถ solution ของ Nagios มีมากขึ้น Nagios XI ตรวจสอบโครงสร้างพื้นฐานด้านไอทีทั้งหมด Nagios Log Server วิเคราะห์และเก็บถาวรบันทึกจากแหล่งต่างๆขององค์กร ในตำแหน่งศูนย์กลางเดียวได้อย่างรวดเร็วและง่าย

#### ความสามารถ
- ใช้ตรวจสอบการทำงานของเซอร์วิสบนเคือข่าย เช่น SMTP, POP3, HTTP, NNTP, ICMP, SNMP, FTP, SSH
- ใช้ตรวจสอบการใช้งานทรัพยากร เช่น processor load, disk usage, system logs
- การรับทราบการแจ้งเตือนให้การสื่อสารเกี่ยวกับปัญหาที่ทราบและการตอบสนองต่อปัญหา
- ความสามารถในการตรวจสอบแอปพลิเคชัน บริการ ระบบปฏิบัติการ โปรโตคอลเครือข่าย ตัวชี้วัดระบบ และส่วนประกอบโครงสร้างพื้นฐานด้วยเครื่องมือเดียว
- การผสานรวมกับแอปพลิเคชันภายในและของบริษัทอื่นทำได้ง่ายด้วย API หลายตัว
- ส่วนเสริมที่พัฒนาโดยชุมชนหลายร้อยรายการขยายฟังก์ชันการทำงานของ Nagios หลัก
- มุมมองแบบรวมศูนย์ของโครงสร้างพื้นฐานด้านไอทีที่ได้รับการตรวจสอบทั้งหมด
- ตัวจัดการเหตุการณ์อนุญาตให้รีสตาร์ทแอปพลิเคชันและบริการที่ล้มเหลวโดยอัตโนมัติ
